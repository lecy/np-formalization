library( foreign )

# NCCS SOI and DIGITIZED DATA

dat <- read.dta( "SOI_2008.dta" )

dd <- read.spss( "Digitized Revenue and Expenses v2005b.sav" )


prog <- dd$P1PEXP
tot <- dd$P1TOTEXP
tot[ tot < 1 ] <- NA

prog.rat <- prog / tot 

prog.rat[ prog.rat > 1 ] <- NA
prog.rat[ prog.rat < 0 ] <- NA

hist( prog.rat )



mg <- dd$P1MEXP

oh.rat <- mg / tot

oh.rat <- mg / (mg + prog)

oh.rat[ oh.rat > 1 ] <- NA
oh.rat[ oh.rat < 0 ] <- NA

hist( oh.rat )


rev.bin <- cut( dd$P1TOTREV, breaks=seq(0,1000000,10000) )

rev.bin <- cut( (mg+prog), breaks=seq(0,1000000,10000) )


med.oh <- tapply( oh.rat, rev.bin, median, na.rm=T ) 

med.oh[1:3] <- NA

plot( med.oh, type="b", pch=19, bty="n", xaxt="n", cex=1.5,
      xlab="Total Expenses", ylab="Overhead Ratio", cex.lab=1.5 )

axis( side=1, at=seq(0,100,10), 
      labels=c("$0","$100k","$200k","$300k","$400k","$500k","$600k","$700k","$800k","$900k","$1m")  )



med.oh <- 
structure(c(NA, NA, NA, 0.0968551879982424, 0.0972099065844555, 
0.0955591634036864, 0.0976618976672115, 0.101803241269117, 0.103100443563821, 
0.104404829739553, 0.101596035404425, 0.109234423964686, 0.110012972113984, 
0.110498073132829, 0.113226662704229, 0.111445115970003, 0.113993475845093, 
0.118952583428354, 0.118577722971019, 0.123078661844485, 0.119656396967079, 
0.124080436549564, 0.124237080031253, 0.127659665998434, 0.128688007575906, 
0.127027091862845, 0.128310487699157, 0.127397040417408, 0.12990551741601, 
0.130536886305048, 0.125782815006089, 0.130582516535182, 0.126312622050822, 
0.12885195789549, 0.12966302238589, 0.131055251536638, 0.130373288350447, 
0.129823907078349, 0.130785964785516, 0.132351060423881, 0.130587917111986, 
0.129717106824998, 0.129736332808092, 0.130358221322575, 0.130194465069641, 
0.128162820588771, 0.127756445059397, 0.129153538595249, 0.132891564016811, 
0.130553838898014, 0.130858660477192, 0.129549716997732, 0.129735360660608, 
0.127341096419319, 0.131059686006675, 0.125277089463163, 0.128274146080758, 
0.128087650596523, 0.130173706456636, 0.127330254494648, 0.128409021342215, 
0.131409446430297, 0.127670280480643, 0.130777505311395, 0.131631606748905, 
0.131208366488576, 0.131693500836312, 0.125775436072225, 0.129372671315276, 
0.130784380407512, 0.125860997316005, 0.124602841263485, 0.133436244322742, 
0.125821039316449, 0.127089510033101, 0.125546802601121, 0.127674161493121, 
0.123595408764709, 0.121905337638951, 0.125130986211974, 0.126531111896984, 
0.124352350641128, 0.126401526769587, 0.126172136585674, 0.126572506520143, 
0.130747673068489, 0.126796631970001, 0.124647708649053, 0.124007847768382, 
0.122039745559127, 0.124862418482481, 0.125621525301528, 0.127394465206233, 
0.127173559023174, 0.129036170266218, 0.130342041576958, 0.128418519421024, 
0.129527265232882, 0.12827166669193, 0.125216335910852), .Dim = 100L)

